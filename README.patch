diff --git a/README_Global_Travel_Atlas.md b/README_Global_Travel_Atlas.md
index 6f5e072..ffa5286 100644
--- a/README_Global_Travel_Atlas.md
+++ b/README_Global_Travel_Atlas.md
@@ -2,20 +2,20 @@
 
 ## Übersicht
 
-**AroundTheWorld** (Global Travel Atlas) ist eine Next.js-Anwendung, die Benutzer*innen ermöglicht, Länder auf einem 3D-Globus zu erkunden, kuratierte Sehenswürdigkeiten (POIs) anzuschauen und eine interaktive Karte mit Reiseplanung und Live-Wettervorhersagen zu nutzen.
+**AroundTheWorld** (Global Travel Atlas) ist eine Next.js-Anwendung, die Benutzerinnen und Benutzer Länder auf einem 3D-Globus erkunden lässt, kuratierte POIs aus lokalen Datensätzen anzeigt und eine interaktive Karte mit Filter, Reiseplanung, Unterkünften sowie Live-Wetterdaten bietet. Ein Atlas Assistant (Ollama) liefert Chat-Antworten und Intents im Country-Panel.
 
 ---
 
 ## 1. Schnelleinstieg
 
 ### Voraussetzungen
-- **Node.js** 18+ und npm
+- **Node.js** und **npm**
 
 ### Installation
 ```bash
 npm install          # Abhängigkeiten installieren
-npm run dev          # Entwicklungsserver starten (mit POI-Registry-Generierung)
-npm run build        # Produktions-Build
+npm run dev          # Entwicklungsserver starten (predev generiert die POI-Registry)
+npm run build        # Produktions-Build (prebuild generiert die POI-Registry)
 npm run start        # Produktions-Server
 ```
 
@@ -31,31 +31,57 @@ npm run pois:validate       # POI-Datensätze validieren
 
 ### Umgebungsvariablen
 
-Erstelle eine `.env.local`-Datei mit folgenden Einträgen:
+Erstelle eine `.env.local` für Provider-Konfiguration und optionale Defaults.
+
+#### Runtime (App)
+
+| Variable | Erforderlich | Beispiel | Zweck |
+|----------|-------------|----------|-------|
+| `OPENWEATHER_API_KEY` | Ja (Wetter) | `YOUR_KEY` | OpenWeather API-Schlüssel für `/api/weather`. |
+| `WEATHER_PROVIDER` | Optional | `openweather` | Wetter-Provider (nur `openweather` implementiert). |
+| `OPENWEATHER_TIMEOUT_MS` | Optional | `8000` | Timeout in ms für OpenWeather-Requests. |
+| `ALLOW_INSECURE_TLS_FOR_DEV` | Optional | `1` | Erlaubt unsichere TLS-Zertifikate in Dev. |
+| `ALLOW_INSECURE_TLS` | Optional | `1` | Alias für unsichere TLS in Dev. |
+| `ALLOW_INSECURE_SSL` | Optional | `1` | Alias für unsichere TLS in Dev. |
+| `NODE_EXTRA_CA_CERTS` | Optional | `C:\\ca.pem` | Pfad zu einer eigenen CA-Datei. |
+| `NEXT_PUBLIC_DEFAULT_UNITS` | Optional | `metric` | Standard-Einheiten für Wetter (`imperial` für US). |
+| `NEXT_PUBLIC_DEFAULT_LANG` | Optional | `de` | Sprache für Wettertexte. |
+| `NEXT_PUBLIC_DEFAULT_LAT` | Optional | `47.3769` | Standard-Kartenmittelpunkt (Latitude). |
+| `NEXT_PUBLIC_DEFAULT_LON` | Optional | `8.5417` | Standard-Kartenmittelpunkt (Longitude). |
+| `NEXT_PUBLIC_MAP_STYLE_URL` | Optional | MapLibre Style JSON | Kartenstil; leer => MapLibre Demo-Style. |
+| `NEXT_PUBLIC_SITE_URL` | Optional | `https://example.com` | Basis-URL für serverseitiges Laden von `/data/countries.geojson`. |
+| `SITE_URL` | Optional | `https://example.com` | Alternative Basis-URL (Server). |
+| `VERCEL_URL` | Optional | `my-app.vercel.app` | Wird zu `https://...` erweitert, wenn keine Basis-URL gesetzt ist. |
+| `GEOCODING_PROVIDER` | Optional | `photon` | Geocoding-Provider (nur `photon` implementiert). |
+| `PLACES_PROVIDER` | Optional | `opentripmap` | Places-Provider (nur `opentripmap` implementiert; `/api/places` ist deprecated). |
+| `OPENTRIPMAP_API_KEY` | Nur falls OpenTripMap genutzt wird | `YOUR_KEY` | API-Key für den OpenTripMap-Service. |
+| `STAYS_PROVIDER` | Optional | `mock` | Stays-Provider: `mock` oder `partner`. |
+| `STAYS_PARTNER_ENDPOINT` | Nur falls `STAYS_PROVIDER=partner` | `https://partner.example.com/stays` | Partner-API Endpoint. |
+| `STAYS_PARTNER_KEY` | Nur falls `STAYS_PROVIDER=partner` | `sk_...` | Partner-API Key. |
+| `NOMINATIM_USER_AGENT` | Optional | `GlobalTravelAtlas/1.0 (contact: https://example.com)` | User-Agent für `/api/poi-details` (Default ist gesetzt). |
+| `AI_PROVIDER` | Optional | `ollama` | KI-Provider für `/api/ai` (nur `ollama` akzeptiert). |
+| `OLLAMA_BASE_URL` | Optional | `http://127.0.0.1:11434` | Ollama Server Basis-URL. |
+| `OLLAMA_URL` | Optional | `http://127.0.0.1:11434` | Alias für `/api/ai/chat` (hat Vorrang vor `OLLAMA_BASE_URL`). |
+| `OLLAMA_MODEL` | Optional | `llama3.1:8b` | Ollama Modell. |
+| `NODE_ENV` | Optional (von Next gesetzt) | `development` | Schaltet Dev/Prod-Logik (Logging, Caches). |
+
+#### Skripte/Tests
 
 | Variable | Erforderlich | Beispiel | Zweck |
-|----------|:---:|----------|---------|
-| `OPENWEATHER_API_KEY` | ✅ | `sk_...` | OpenWeather API-Zugriff |
-| `WEATHER_PROVIDER` | ❌ | `openweather` | Wetter-Service Auswahl |
-| `GEOCODING_PROVIDER` | ❌ | `photon` | Geocoding-Service Auswahl |
-| `PLACES_PROVIDER` | ❌ | `opentripmap` | Orte-Service Auswahl |
-| `STAYS_PROVIDER` | ? | `mock` | Stays-Provider (mock oder partner) |
-| `STAYS_PARTNER_ENDPOINT` | ? | `https://partner.example.com/stays` | Partner-API Endpoint |
-| `STAYS_PARTNER_KEY` | ? | `sk_...` | Partner-API Key |
-| `NEXT_PUBLIC_DEFAULT_LAT` | ❌ | `47.3769` | Standard-Kartenbreite |
-| `NEXT_PUBLIC_DEFAULT_LON` | ❌ | `8.5417` | Standard-Kartenlänge |
-| `NEXT_PUBLIC_DEFAULT_UNITS` | ❌ | `metric` | Wetter-Einheiten |
-| `NEXT_PUBLIC_DEFAULT_LANG` | ❌ | `de` | Wetter-Sprache |
-| `NEXT_PUBLIC_MAP_STYLE_URL` | ❌ | MapLibre Style JSON | Kartenstil |
-| `AI_PROVIDER` | ❌ | `ollama` | KI-Provider |
-| `OLLAMA_BASE_URL` | ❌ | `http://127.0.0.1:11434` | Ollama-Server |
-| `OLLAMA_MODEL` | ❌ | `llama3.1:8b` | Ollama-Modell |
+|----------|-------------|----------|-------|
+| `ENABLE_GEOCODE` | Optional | `1` | Aktiviert Nominatim-Geocoding in `scripts/merge-all-pois.ts`. |
+| `NOMINATIM_USER_AGENT` | Optional | `GlobalTravelAtlas/1.0 (contact: https://example.com)` | Wird auch von Merge-Skripten genutzt. |
+| `AIML_API_KEY` | Ja (test-aimlapi) | `YOUR_KEY` | API-Key für `scripts/test-aimlapi.mjs`. |
+| `AIML_API_BASE_URL` | Optional | `https://api.aimlapi.com/v1` | Basis-URL für `scripts/test-aimlapi.mjs`. |
+| `AIML_MODEL` | Optional | `gpt-4o-mini` | Modell für `scripts/test-aimlapi.mjs`. |
+| `AIML_MAX_TOKENS` | Optional | `128` | Max Tokens für `scripts/test-aimlapi.mjs`. |
+| `LOCAL_AI_URL` | Optional | `http://localhost:3000/api/ai` | Ziel für `scripts/test-local-ai.mjs`. |
 
 ---
 
 ## 2. Projekt-Struktur
 
-### 📁 Hauptverzeichnisse
+### Hauptverzeichnisse
@@
-│   ├── lib/                    # Geschäftslogik & Services
+│   ├── lib/                    # Business-Logik & Services
@@
-│   ├── data/                   # GeoJSON & Statische Daten
+│   ├── data/                   # GeoJSON & Datensätze
@@
-### 🔑 Wichtige Dateien
+### Wichtige Dateien
@@
-| `src/app/map/page.tsx` | Interaktive Kartenseite |
-| `src/app/country/[code]/page.tsx` | Länder-Details Panel |
-| `src/components/landing/LandingClient.tsx` | Globus-UI Controller |
-| `src/components/map/MapView.tsx` | Kartenfunktionalität |
-| `src/components/panels/CountryPanel.tsx` | Länder-Informations-Panel |
+| `src/app/map/page.tsx` | Map-Seite mit initialen POIs |
+| `src/app/country/[code]/page.tsx` | Länder-Detailseite |
+| `src/components/globe/GlobeGL.tsx` | 3D-Globus Rendering & Länder-Auswahl |
+| `src/components/map/MapView.tsx` | MapLibre-Karte mit POIs, Stays und Itinerary |
+| `src/components/panels/CountryPanel.tsx` | Country-Panel (Wetter, Flüge, POIs, Chat) |
+| `src/components/ai/AtlasChat.tsx` | Atlas Assistant UI |
+| `src/components/itinerary/ItineraryWidget.tsx` | Reiseplanung & Routenoptimierung |
+| `src/app/api/poi-details/route.ts` | POI-Details Enrichment |
+| `src/app/api/atlas-assistant/route.ts` | Atlas Assistant API |
@@
-┌─────────────────────────────────────────────────┐
-│          Benutzer-Interface (React)             │
-├─────────────────────────────────────────────────┤
-│  3D-Globus │ Karte │ Land-Panel │ KI-Chat      │
-└──────────────────┬──────────────────────────────┘
-           │
-     ┌───────────┴───────────┐
-     ↓                       ↓
-   ┌─────────┐          ┌──────────────┐
-   │ API     │          │ Datenquellen │
-   │ Routes  │          ├──────────────┤
-   ├─────────┤          │ GeoJSON      │
-   │ /weather│          │ POI-Datasets │
-   │ /pois   │          │ Metadaten    │
-   │ /geocode│          └──────────────┘
-   │ /ai     │
-   │ /details│
-   └────┬────┘
-    │
-    ↓
-   ┌──────────────────┐
-   │ Externe Services │
-   ├──────────────────┤
-   │ OpenWeather      │
-   │ OpenTripMap      │
-   │ Photon (Geocode) │
-   │ Ollama (KI)      │
-   └──────────────────┘
+┌─────────────────────────────────────────────────────────────┐
+│             Benutzer-Interface (React)                      │
+├─────────────────────────────────────────────────────────────┤
+│  3D-Globus │ Karte │ Country-Panel │ Atlas Assistant Chat   │
+└──────────────────────┬──────────────────────────────────────┘
+            │
+     ┌──────┴─────────┐
+     ↓                ↓
+  ┌─────────┐     ┌──────────────┐
+  │ API     │     │ Datenquellen │
+  │ Routes  │     ├──────────────┤
+  │ /weather│     │ countries.geojson
+  │ /pois   │     │ POI-JSON (cities/countries/global.sample)
+  │ /geocode│     │ countries.meta.json
+  │ /poi-details  │ stays datasets
+  │ /stays  │     └──────────────┘
+  │ /atlas-assistant
+  │ /ai (/ai/chat)
+  └────┬────┘
+       │
+       ↓
+  ┌──────────────────┐
+  │ Externe Services │
+  ├──────────────────┤
+  │ OpenWeather      │
+  │ Photon (Geocode) │
+  │ Nominatim / Overpass
+  │ Wikidata / Wikipedia
+  │ Ollama (KI)      │
+  └──────────────────┘
@@
-| **MapView** | Interaktive Karte mit POI-Filtern |
-| **CountryPanel** | Wetter, Sehenswürdigkeiten, Flüge, KI-Chat |
-| **PoiDetailsDrawer** | Detaillierte POI-Informationen |
-| **ItineraryWidget** | Reiseplanung & Routenoptimierung |
-| **AtlasChat** | KI-Assistent mit Streaming-Antworten |
+| **MapView** | Interaktive MapLibre-Karte mit POI-Filtern, Stays und Itinerary |
+| **CountryPanel** | Wetter, Flüge, POIs und Atlas-Chat |
+| **PoiDetailsDrawer** | POI-Details (Enrichment via `/api/poi-details`) |
+| **ItineraryWidget** | Reiseplanung, Optimierung und Teilen |
+| **AtlasChat** | KI-Assistent (Atlas Assistant) |
@@
-### `/api/weather`
-**Funktionalität:** Aktuelle Wetter- und Vorhersagedaten  
-**Parameter:** `lat`, `lon`  
-**Antwort:** `{ current: {...}, daily: [...] }`  
-**Caching:** 10 Minuten
-
-### `/api/pois`
-**Funktionalität:** Kuratierte Sehenswürdigkeiten  
-**Parameter:** `lat`, `lon`, `country`, `limit`, `category`  
-**Antwort:** `{ pois: [{ id, name, category, lat, lon, ... }] }`  
-**Datenquelle:** Lokale Datensätze
-
-### `/api/stays`
-**Funktionalit?t:** Unterk?nfte im aktuellen Kartenausschnitt (Provider-basiert, kein Scraping)  
-**Parameter:** `bbox=minLon,minLat,maxLon,maxLat`, `minPrice`, `maxPrice`, `currency`, `limit`  
-**Antwort:** `{ stays: [{ id, title, lat, lon, price, currency, ... }], meta: { source, fallback?, error? } }`  
-**Caching:** 60 Sekunden (In-Memory)
-
-### `/api/geocode`
-**Funktionalität:** Adresse ↔ Koordinaten  
-**Parameter:** `address` oder `lat`, `lon`  
-**Antwort:** `{ lat, lon, address, city }`  
-**Provider:** Photon  
-**Caching:** 7 Tage
-
-### `/api/poi-details`
-**Funktionalität:** Erweiterte POI-Informationen  
-**Parameter:** `id`, `lat`, `lon`  
-**Antwort:** `{ address, images, wikipedia, osmTags, ... }`  
-**Quellen:** Nominatim, Overpass, Wikidata, Wikipedia
-
-### `/api/ai`
-**Funktionalität:** KI-Assistent mit Streaming  
-**Parameter:** `message`, `context`  
-**Antwort:** Server-Sent Events (SSE)  
-**Provider:** Ollama (lokal)  
-**Format:** JSON-Action-Envelopes
+### `/api/weather` (GET)
+**Funktionalität:** Aktuelle Wetter- und Vorhersagedaten (OpenWeather)  
+**Parameter:** `lat`, `lon`, optional `allowZero=1|true`  
+**Antwort:** `WeatherData` (`provider`, `location`, `current`, `daily`, `errors?`)  
+**Caching:** `unstable_cache` mit `revalidate=600` (10 Minuten), Stale-Fallback im Speicher  
+**Hinweis:** Einheiten und Sprache kommen aus `NEXT_PUBLIC_DEFAULT_UNITS`/`NEXT_PUBLIC_DEFAULT_LANG`.
+
+### `/api/pois` (GET)
+**Funktionalität:** Kuratierte POIs aus lokalen Datensätzen  
+**Parameter:** `country` (ISO-2/ISO-3 oder Name), `city`, `lat`, `lon`, `limit`, `category` (`landmarks|museums|food|nightlife|nature|other|all`)  
+**Antwort:** `POI[]` (Array)  
+**Hinweis:** Es muss mindestens `country`, `city` oder `lat/lon` gesetzt sein.
+
+### `/api/places` (GET)
+**Funktionalität:** Deprecated Alias für `/api/pois` (externe Provider sind deaktiviert).
+
+### `/api/static-places` (GET)
+**Funktionalität:** Deprecated; nutzt `/api/pois` mit `lat/lon` Pflicht und `category=all`.
+
+### `/api/stays` (GET)
+**Funktionalität:** Unterkünfte im aktuellen Kartenausschnitt (Provider-basiert, kein Scraping)  
+**Parameter:** `bbox=minLon,minLat,maxLon,maxLat`, optional `minPrice`, `maxPrice`, `currency`, `limit`, `country`  
+**Antwort:** `{ stays: Stay[], meta: { source, fallback?, error? } }`  
+**Caching:** In-Memory Cache, TTL 60 Sekunden  
+**Provider:** `STAYS_PROVIDER=mock|partner` mit Mock-Fallback bei Partner-Fehlern.
+
+### `/api/geocode` (GET)
+**Funktionalität:** Adresse/Ort → Koordinaten (Photon)  
+**Parameter:** `q`  
+**Antwort:** `GeocodeResult[]`  
+**Caching:** `unstable_cache` mit `revalidate=7 Tage`
+
+### `/api/poi-details` (GET)
+**Funktionalität:** Erweiterte POI-Informationen  
+**Parameter:** `lat`, `lon`, optional `name`, `category`  
+**Antwort:** `{ address, city, openingHours, website, osm, images }`  
+**Quellen:** Nominatim, Overpass, Wikidata, Wikipedia  
+**Caching:** In-Memory Cache in Dev; in Prod `Cache-Control: s-maxage=86400, stale-while-revalidate=604800`
+
+### `/api/atlas-assistant` (POST)
+**Funktionalität:** Atlas Assistant Chat (Ollama, JSON)  
+**Body:** `{ messages, agentMode?, uiState? }`  
+**Antwort:** `AtlasAssistantResponse` (`message_md`, `quick_replies?`, `intents?`)
+
+### `/api/ai` (POST, SSE)
+**Funktionalität:** Streaming-Chat mit Actions (Ollama, SSE)  
+**Body:** `{ messages, context?, threadKey?, agentMode?, uiContext? }`  
+**Antwort:** Server-Sent Events (`delta`, `actions`, `done`, `error`)  
+**Provider:** `AI_PROVIDER=ollama` (sonst Fehler)
+
+### `/api/ai/chat` (POST)
+**Funktionalität:** TravelBot (Ollama, JSON)  
+**Body:** `{ messages, appState? }`  
+**Antwort:** `TravelBotResponse` (`message_md`, `quick_replies`, `state`)  
+**Hinweis:** Nutzt `OLLAMA_URL` oder `OLLAMA_BASE_URL`.
@@
-  name: string                  // Sehenswürdigkeits-Name
-  category: string              // Kategorie (museum, restaurant, etc.)
+  name: string                  // Name
+  category: PlaceCategory       // Kategorie
   lat: number                   // Breitengrad
   lon: number                   // Längengrad
-  city: string                  // Stadt
-  country: string               // Land-Code (ISO-2)
-  source: string                // Datenquelle
-  address?: string              // Optional: Adresse
-  images?: string[]             // Optional: Bilder
-  osm?: object                  // Optional: OSM-Metadaten
+  source: "static" | "curated" | "opentripmap"
+  countryCode?: string          // ISO-2/ISO-3
+  cityId?: string               // Slug (z.B. "zurich")
+  city?: string                 // Anzeigename
+  googlePlaceId?: string
+  description?: string
+  address?: string
+  rating?: number
+  website?: string
+  mapsUrl?: string
+  imageUrl?: string
+  images?: { url: string; source: "wikimedia" | "wikipedia"; attribution?: string }[]
+  openingHours?: string
+  osm?: { type: "N" | "W" | "R"; id: number }
+  tags?: string[]
@@
-- `museum` – Museen & Kunstgalerien
-- `monument` – Denkmal & historische Stätten
-- `restaurant` – Restaurants & Cafés
-- `hotel` – Übernachtungen
-- `attraction` – Sehenswürdigkeiten
-- `nature` – Parks & Naturgebiete
+- `landmarks` – Sehenswürdigkeiten & historische Orte
+- `museums` – Museen & Galerien
+- `food` – Essen & Trinken
+- `nightlife` – Bars & Nightlife
+- `nature` – Natur & Parks
+- `other` – Sonstiges
@@
-**Nach Land:** `src/lib/data/pois/datasets/countries/*.json`  
-Beispiele: `DE.json` (Deutschland), `FR.json` (Frankreich)
+**Nach Land:** `src/lib/data/pois/datasets/countries/*.json`  
+Beispiele: `DE.json`, `FR.json`
+
+**Fallback:** `src/lib/data/pois/datasets/global.sample.json` wird genutzt, wenn kein passender City- oder Country-Datensatz existiert.
@@
 npm run predev    # vor npm run dev
+npm run prebuild  # vor npm run build
@@
-Sie enthält:
-- City-Loaders mit Bounding-Boxes
-- Land-Datensatz-Zuordnungen
+Sie enthält:
+- City-Loader mit Bounding-Boxes
+- Country-Datensatz-Zuordnungen
 - Koordinaten-Zentren für Zoom-Funktionen
@@
-Die Stays-API nutzt Mock-Datensaetze pro Land:
-- public/data/stays/countries/<CC>.json
+Die Stays-API nutzt Mock-Datensätze pro Land:
+- `public/data/stays/countries/<CC>.json`
+
+Optional:
+- `public/data/stays.all.json`
+
+Fallback (Legacy):
+- `public/data/stays.mock.json`
@@
-### ➕ Neues Land hinzufügen
+### Neues Land hinzufügen
@@
-   {
-     "id": "poi-1",
-     "name": "Sehenswürdigkeit",
-     "category": "museum",
-     "lat": 51.5074,
-     "lon": -0.1278,
-     "city": "Hauptstadt",
-     "country": "XX",
-     "source": "manual"
-   }
+     {
+       "id": "country-xx-sample-1",
+       "name": "Sehenswürdigkeit",
+       "category": "landmarks",
+       "lat": 51.5074,
+       "lon": -0.1278,
+       "source": "static",
+       "countryCode": "XX",
+       "city": "Hauptstadt",
+       "address": "Zentrum"
+     }
@@
-### ➕ Neue POI-Kategorie hinzufügen
+### Neue POI-Kategorie hinzufügen
@@
-1. **In `src/lib/data/pois/constants.ts`:**
+1. **In `src/lib/types.ts` die Union erweitern:**
@@
-   export const PLACE_CATEGORIES = [
-   'museum',
-   'restaurant',
-   'my_new_category',  // ← hinzufügen
-   // ...
-   ] as const;
+   export type PlaceCategory =
+     | "landmarks"
+     | "museums"
+     | "food"
+     | "nightlife"
+     | "nature"
+     | "other"
+     | "my_new_category";
@@
-2. **In `src/components/map/PoiCategoryIcon.tsx`:**
+2. **In `src/lib/data/pois/constants.ts` hinzufügen:**
@@
-   case 'my_new_category':
-   return <MyNewCategoryIcon />;
+   export const PLACE_CATEGORIES = [
+     "landmarks",
+     "museums",
+     "food",
+     "nightlife",
+     "nature",
+     "other",
+     "my_new_category",
+   ] as const;
@@
-3. **Filter aktualisieren in `MapView.tsx`**
+3. **In `src/components/map/PoiCategoryIcon.tsx` Icon ergänzen.**
@@
-### ➕ Neue API-Route erstellen
+### Neue API-Route erstellen
@@
-   import { ServiceError } from '@/lib/services/errors';
+   import { logServiceError, toErrorResponse } from "@/lib/services/errors";
@@
-   try {
-     // Logik hier
-     return Response.json({ data: result });
-   } catch (error) {
-     return ServiceError.handleError(error);
-   }
+     try {
+       // Logik hier
+       return Response.json({ data: result });
+     } catch (error) {
+       const { serviceError, status, body } = toErrorResponse(error);
+       logServiceError("api/myfeature", serviceError);
+       return Response.json(body, { status });
+     }
@@
-   const response = await fetch('/api/myfeature?param=value');
+   const response = await fetch("/api/myfeature?param=value");
@@
-| `/api/weather` | `unstable_cache` | 10 Minuten | Häufige Anfragen |
-| `/api/geocode` | `unstable_cache` | 7 Tage | Selten ändernd |
-| `/api/poi-details` | In-Memory | Session | Teure Lookups |
+| `/api/weather` | `unstable_cache` | 10 Minuten | Wetterdaten pro Koordinate/Units/Language cachen |
+| `/api/geocode` | `unstable_cache` | 7 Tage | Geocoding ist teuer und selten ändernd |
+| `/api/poi-details` | `Cache-Control` (Prod) / In-Memory (Dev) | 1 Tag + SWR 7 Tage | Externe Lookups + Bilder |
+| `/api/stays` | In-Memory | 60 Sekunden | Stays-Abfragen im gleichen Viewport |
@@
-✅ **Gut für Renderer:**
-- `GlobeGL` und `MapView` mit stabilen Props
-- Memoization für teure Components
-- Lazy Loading für große Datensätze
-
-⚠️ **Zu vermeiden:**
-- Inline-Funktionen in Props
-- Unnötige Re-Renders
-- Große POI-Listen ohne Pagination (>500)
+- POI-Details werden nur bei Bedarf nachgeladen und clientseitig gecached (Drawer).
+- MapView filtert und sortiert POIs clientseitig und memoisiert teure Berechnungen.
+- Das Länder-GeoJSON wird serverseitig mit `revalidate=86400` geladen.
@@
-**Ursache:** TypeScript-Script-Ausführung  
+**Ursache:** `predev` führt `node scripts/generate-poi-registry.ts` aus (TypeScript).  
@@
-# Option 1: npx tsx verwenden
+# Option 1: tsx verwenden
@@
-- [ ] API-Key gültig?
+- [ ] `WEATHER_PROVIDER` = `openweather`?
@@
-- Fallback auf Demo-Tiles aktivieren?
+- In Dev: Konsolenwarnung zum Demo-Style beachten.
+
+### Problem: Stays werden nicht angezeigt
+
+**Überprüfen:**
+- `STAYS_PROVIDER` gesetzt (`mock` oder `partner`)?
+- `public/data/stays/countries/<CC>.json` vorhanden (Mock)?
+- Bei Partner: `STAYS_PARTNER_ENDPOINT` und `STAYS_PARTNER_KEY` gesetzt?
+
+### Problem: Atlas Assistant reagiert nicht
+
+**Überprüfen:**
+- Läuft Ollama unter `OLLAMA_BASE_URL`?
+- Ist `OLLAMA_MODEL` verfügbar?
@@
-| **Framework** | Next.js | 16 |
-| **Rendering** | React | 19 |
-| **Sprache** | TypeScript | Latest |
-| **Styling** | Tailwind CSS | 4 |
-| **UI-Komponenten** | shadcn/ui (Radix) | Latest |
-| **3D-Globus** | globe.gl + three.js | Latest |
-| **Kartierung** | MapLibre GL | Latest |
-| **Testing** | Vitest + Playwright | Latest |
+| **Framework** | Next.js | ^16.1.5 |
+| **Rendering** | React | 19.2.3 |
+| **Sprache** | TypeScript | ^5 |
+| **Styling** | Tailwind CSS | ^4 |
+| **UI-Komponenten** | Radix UI (Dialog/Slider/Slot) | ^1.1.15 / ^1.3.5 / ^1.2.4 |
+| **3D-Globus** | globe.gl + three.js | ^2.45.0 + ^0.182.0 |
+| **Kartierung** | MapLibre GL + react-map-gl | ^5.15.0 + ^8.1.0 |
+| **Testing** | Vitest + Playwright | ^4.0.16 + ^1.57.0 |
@@
-✅ RICHTIG:
+RICHTIG:
@@
-❌ FALSCH:
+FALSCH:
@@
-| ✅ Do | ❌ Don't |
+| Do | Don't |
@@
-📚 **Dokumentation:**
+**Dokumentation:**
@@
-🔗 **Externe APIs:**
+**Externe APIs:**
@@
-- [OpenTripMap](https://opentripmap.com/api)
 - [Nominatim (OSM)](https://nominatim.org/)
+- [Overpass API](https://overpass-api.de/)
+- [Wikidata](https://www.wikidata.org/)
+- [Wikipedia REST API](https://www.mediawiki.org/wiki/REST_API)
+- [Ollama](https://ollama.com/)
+- [OpenTripMap](https://opentripmap.com/api) (optional, Places-Service)
@@
-🛠️ **Development Tools:**
-- `tsx` – TypeScript Node Runner
+**Development Tools:**
 - `vitest` – Unit Testing
 - `playwright` – E2E Testing
 - `eslint` – Code Linting
 
 ---
-
-**Viel Erfolg beim Entwickeln! 🚀**